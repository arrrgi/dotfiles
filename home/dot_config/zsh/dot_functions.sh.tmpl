#
# SPDX-FileCopyrightText: (c) 2024 Rowan Gillson <devops@the.bald.engineer>
# SPDX-License-Identifier: MIT
#

# shellcheck disable=SC0154
{{- if and (stat "/home/linuxbrew/.linuxbrew/bin") (stat "/home/linuxbrew/.linuxbrew/sbin") -}}
# Shell function to run sudo with Homebrew's path if Homebrew is installed
function sudo() {
    local BREW_BIN="/home/linuxbrew/.linuxbrew/bin"
    local BREW_SBIN="/home/linuxbrew/.linuxbrew/sbin"

    # Check if either Homebrew bin or sbin exists
    if [[ -d "$BREW_BIN" || -d "$BREW_SBIN" ]]; then
        # Construct the Homebrew PATH
        local BREW_PATH=""
        [[ -d "$BREW_BIN" ]] && BREW_PATH="$BREW_BIN"
        [[ -d "$BREW_SBIN" ]] && BREW_PATH="${BREW_PATH:+$BREW_PATH:}$BREW_SBIN"

        # Prepend the Homebrew PATH if it's not already in the current PATH
        if [[ ":$PATH:" != *":$BREW_PATH:"* ]]; then
            PATH="$BREW_PATH:$PATH"
        fi
    fi

    # Execute sudo with the updated PATH
    command sudo env "PATH=$PATH" "$@"
}
{{- end }}


# Shell function for Broot to cd into a directory - workaround for Zsh integration
function br {
    emulate -L zsh
    (){ broot --outcmd $1 ${@:2} && source $1 } =() $@
}
